"use strict";var e=require("puppeteer"),t=require("lodash.merge"),r=require("fs"),s=require("ejs"),a=require("path");const n=e=>r.readFileSync(e,"utf-8");var o;!function(e){e.ejs=".ejs",e.html=".html"}(o||(o={}));const i=(e,t)=>t.reduce(((t,i)=>{let c={};return r.readdirSync(a.resolve(i)).forEach((t=>{const r=((e,t)=>{const r=a.parse(t),i=r.name;return r.ext===o.ejs?{[i]:s.compile(n(a.resolve(r.dir,r.base)),{...e.ejsOptions,filename:i,async:!1,cache:!0})}:r.ext===o.html?{[i]:s.compile(n(a.resolve(r.dir,r.base)),{...e.ejsOptions,filename:i,async:!1,cache:!0})}:{}})(e,a.resolve(i,t));c={...c,...r}})),{...t,...c}}),{}),c={templatesDir:[],ejsOptions:{root:"src",views:["src/templates"]}},l={format:"letter",displayHeaderFooter:!0,headerTemplate:"",footerTemplate:"",margin:{top:"60px",bottom:"60px",left:"40px",right:"40px"}};exports.initialise=async r=>{let s=null;try{s=await e.launch({headless:!0,args:["--no-sandbox","--disable-setuid-sandbox"],ignoreDefaultArgs:["--disable-extensions"]})}catch(e){console.log(e),process.exit(1)}const a=(e=>{const{templatesDir:t}=e;return i(e,t)})(t(c,r));return async({document:e,data:t})=>{const r=a[e];if(!r)throw new Error(`Document ${e} not found`);const n=r(t),o=await(async(e,t,r)=>{const s=await e.newPage();await s.setContent(t,{waitUntil:"networkidle0"});const a=await s.pdf(r);return await s.close(),a})(s,n,l);return o}};
